(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function n(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(r){if(r.ep)return;r.ep=!0;const o=n(r);fetch(r.href,o)}})();const x=new URL(window.location.href),h=x.searchParams.get("api")||"https://find-yv-from-oe-list.onrender.com/api";console.log(`[ENV: production] Using API: ${h}`);const l=document.getElementById("dropzone"),y=document.getElementById("fileInput"),C=document.getElementById("browseBtn"),m=document.getElementById("uploadBtn"),v=document.getElementById("downloadBtn"),z=document.getElementById("clearBtn"),w=document.getElementById("fileInfo"),M=document.getElementById("fileName"),O=document.getElementById("fileSize"),c=document.getElementById("alert"),B=document.getElementById("progressWrap"),I=document.getElementById("progressBar"),b=document.getElementById("progressLabel"),p=document.getElementById("searchKeywords"),S=document.getElementById("addKeywordBtn");let g=null,u=null,d=[""];function a(e,t="info"){c.textContent=e,c.className="alert "+t,c.classList.remove("hidden")}function k(){c.classList.add("hidden")}function D(e){if(!e&&e!==0)return"";const t=["B","KB","MB","GB"],n=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,n)).toFixed(1)+" "+t[n]}function L(e){g=e,e?(M.textContent=e.name,O.textContent="• "+D(e.size),w.classList.remove("hidden"),m.disabled=!1,v.disabled=!0,u=null):(w.classList.add("hidden"),m.disabled=!0)}function f(e,t){B.classList.remove("hidden"),I.value=e,b.textContent=t||e+"%"}function P(){B.classList.add("hidden"),I.value=0,b.textContent="Preparing…"}function E(){p.innerHTML="",d.forEach((e,t)=>{const n=document.createElement("div");n.className="input-group keyword-item",n.innerHTML=`
      <input type="text" class="input-field" placeholder="OE, OEM, TRW vb." value="${e}" />
      ${d.length>1?'<button type="button" class="btn btn-ghost remove-btn">&times;</button>':""}
      <div class="keyword-error hidden"></div>
    `;const s=n.querySelector("input"),r=n.querySelector(".remove-btn");s.addEventListener("input",o=>{const i=o.target.value.trim();d[t]=i,K(s)}),r==null||r.addEventListener("click",()=>{d.splice(t,1),E()}),p.appendChild(n)})}function K(e){const t=e.value.trim(),n=e.parentElement.querySelector(".keyword-error");return n.classList.add("hidden"),e.classList.remove("is-error"),t.length>0&&t.length<2?(n.textContent="En az 2 karakter olmalı.",n.classList.remove("hidden"),e.classList.add("is-error"),!1):d.filter(o=>o.length>0).filter(o=>o===t).length>1?(n.textContent="Bu kelime zaten mevcut.",n.classList.remove("hidden"),e.classList.add("is-error"),!1):!0}["dragenter","dragover"].forEach(e=>l.addEventListener(e,t=>{t.preventDefault(),t.stopPropagation(),l.classList.add("is-drag")}));["dragleave","drop"].forEach(e=>l.addEventListener(e,t=>{t.preventDefault(),t.stopPropagation(),l.classList.remove("is-drag")}));l.addEventListener("drop",e=>{var n,s;const t=(s=(n=e.dataTransfer)==null?void 0:n.files)==null?void 0:s[0];t&&L(t)});C.addEventListener("click",()=>y.click());y.addEventListener("change",e=>{var n;const t=(n=e.target.files)==null?void 0:n[0];t&&L(t)});z.addEventListener("click",()=>{y.value="",L(null),k(),P()});S.addEventListener("click",()=>{d.push(""),E()});m.addEventListener("click",async()=>{if(k(),!g){a("Lütfen bir dosya seçin.","error");return}const e=p.querySelectorAll(".keyword-item input");let t=!0;if(e.forEach(s=>{K(s)||(t=!1)}),!t){a("Lütfen arama kelimelerindeki hataları düzeltin.","error");return}const n=d.filter(s=>s.length>0);if(n.length===0){a("Lütfen en az bir arama kelimesi girin.","error");return}try{const s=new FormData;s.append("file",g),s.append("keywords",n.join(",")),f(20,"Yükleniyor…");const r=await fetch(`${h}/upload`,{method:"POST",body:s});if(!r.ok){const i=await r.text();throw new Error(i||"Upload failed")}f(70,"Sunucuda işleniyor…");const o=await r.json();if(!(o!=null&&o.filename))throw new Error("Invalid response");u=o.filename,f(100,"Tamamlandı"),a("Dosya başarıyla işlendi.","success"),v.disabled=!1}catch(s){console.error(s),a(s.message||"Beklenmedik bir hata oluştu.","error"),P()}});v.addEventListener("click",()=>{u&&(window.location.href=`${h}/download/${encodeURIComponent(u)}`)});document.addEventListener("DOMContentLoaded",()=>{E()});
